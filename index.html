<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0" name="viewport">
  <br/>
  <title>PieWatch Configuration</title>
  <link rel="stylesheet" href="slate/dist/css/slate.css">
  <style>
	.title {
		text-align: center; 
	} 
  </style>
</head>

<body>
<div id="main-form">
  <H2 class="title">PieWatch Configuration</H2>
    <div class="item-container">
      <div class="item-container-content">
        <div class="item">
         Use this configuration page to choose the settings you would like applied to this app.
        </div>
      </div>
    </div>

    <div class="item-container">
      <div class="item-container-header">Invert watchface (for Pebble and Pebble Steel only):</div>
      <div class="item-container-content">
        <label class="item">
          Invert watchface
		  <input id="invert_select" type="checkbox" class="item-toggle" name="toggle-1" />
        </label>
      </div>
      <div class="item-container-footer">
      </div>
    </div>
	
	<div class="item-container">
      <div class="item-container-header">Second Hand</div>
      <div class="item-container-content">
        <label class="item">
          Display second hand
		  <input id="seconds_display" type="checkbox" class="item-toggle" name="toggle-1" />
        </label>
      </div>
      <div class="item-container-footer">
      </div>
    </div>

    <div class="item-container">
      <div class="item-container-header">Colour Pickers</div>
      <div class="item-container-content">
        <label class="item">
          Outer Background Colour (not visible in Pebble Round)
          <input id="obgcolour_display" type="text" class="item-color item-color-normal" name="color-1" value="0x0000FF">
        </label>
		<label class="item">
          Inner (Clock) Background Colour
          <input id="ibgcolour_display" type="text" class="item-color item-color-normal" name="color-1" value="0xFFFFFF">
        </label>
		<label class="item">
          Second Hand Colour
          <input id="shcolour_display" type="text" class="item-color item-color-normal" name="color-1" value="0xFF0000">
        </label>
		<label class="item">
          Minute Hand Colour
          <input id="mhcolour_display" type="text" class="item-color item-color-normal" name="color-1" value="0x000000">
        </label>
		<label class="item">
          Hour Hand Colour
          <input id="hhcolour_display" type="text" class="item-color item-color-normal" name="color-1" value="0x000000">
        </label>
		<label class="item">
          Ticks Colour
          <input id="tcolour_display" type="text" class="item-color item-color-normal" name="color-1" value="0x000000">
        </label>
		<label class="item">
          Dot in the Middle Colour
          <input id="dcolour_display" type="text" class="item-color item-color-normal" name="color-1" value="0x000000">
        </label>
		<label class="item">
          Clock Numbers Colour
          <input id="ncolour_display" type="text" class="item-color item-color-normal" name="color-1" value="0x000000">
        </label>
		<label class="item">
          Date Colour
          <input id="dtcolour_display" type="text" class="item-color item-color-normal" name="color-1" value="0xFFFF00">
        </label>
		<label class="item">
          Circle Border Colour
          <input id="ccolour_display" type="text" class="item-color item-color-normal" name="color-1" value="0x000000">
        </label>
		<label class="item">
          Battery Percentage Colour
          <input id="bcolour_display" type="text" class="item-color item-color-normal" name="color-1" value="0x0000FF">
        </label>		
      </div>
	  <div class="item-container-footer">The settings above will only change on the watch after pressing the SAVE button below.</div>
    </div>

    <div class="item-container">
      <div class="button-container">
        <input id ="submit_button" type="submit" class="item-button" value="SAVE">
      </div>
    </div>
  </div>
 </body>
 
 <script type="text/javascript" src="slate/dist/js/slate.js"></script>
 <script>
 
	(function(){
		loadOptions();
		submitHandler();	
	})();
 
   function getConfigData() {
        var invertSelect = document.getElementById("invert_select");
		var secondsDisplay = document.getElementById("seconds_display");
		var obgcolourDisplay = document.getElementById("obgcolour_display");
		var ibgcolourDisplay = document.getElementById("ibgcolour_display");
		var shcolourDisplay = document.getElementById("shcolour_display");
		var mhcolourDisplay = document.getElementById("mhcolour_display");
		var hhcolourDisplay = document.getElementById("hhcolour_display");
		var tcolourDisplay = document.getElementById("tcolour_display");
		var dcolourDisplay = document.getElementById("dcolour_display");
		var ncolourDisplay = document.getElementById("ncolour_display");
		var dtcolourDisplay = document.getElementById("dtcolour_display");
		var ccolourDisplay = document.getElementById("ccolour_display");
		var bcolourDisplay = document.getElementById("bcolour_display");
		
		var options = {
          "invert": invertSelect.checked ? "true":"false",
		  "seconds": secondsDisplay.checked ? "true":"false",
		  "obgcolour": obgcolourDisplay.value,
		  "ibgcolour": ibgcolourDisplay.value,
		  "shcolour": shcolourDisplay.value,
		  "mhcolour": mhcolourDisplay.value,
		  "hhcolour": hhcolourDisplay.value,
		  "tcolour": tcolourDisplay.value,
		  "dcolour": dcolourDisplay.value,
		  "ncolour": ncolourDisplay.value,
		  "dtcolour": dtcolourDisplay.value,
		  "ccolour": ccolourDisplay.value,
		  "bcolour": bcolourDisplay.value
		};
			localStorage["invert"] = options.invert;
			localStorage["seconds"] = options.seconds;
			localStorage["obgcolour"] = options.obgcolour;
			localStorage["ibgcolour"] = options.ibgcolour;
			localStorage["shcolour"] = options.shcolour;
			localStorage["mhcolour"] = options.mhcolour;
			localStorage["hhcolour"] = options.hhcolour;
			localStorage["tcolour"] = options.tcolour;
			localStorage["dcolour"] = options.dcolour;
			localStorage["ncolour"] = options.ncolour;
			localStorage["dtcolour"] = options.dtcolour;
			localStorage["ccolour"] = options.ccolour;
			localStorage["bcolour"] = options.bcolour;

		console.log('Got options: ' + JSON.stringify(options));	
        return options;
      }

	function getQueryParam(variable, default_) {
			var query = location.search.substring(1);
			var vars = query.split('&');
			for (var i = 0; i < vars.length; i++) {
				var pair = vars[i].split('=');
				if (pair[0] == variable) {
				return decodeURIComponent(pair[1]);
			}
		}
		return default_ || false;
	}	
	  
	  
	function submitHandler(){
	  var submitButton = document.getElementById("submit_button");
	  submitButton.addEventListener("click", 
		function() {
			console.log("Submit");
			var options = getConfigData();
	  
	  var return_to = getQueryParam('return_to', 'pebblejs://close#');
	  document.location = return_to + encodeURIComponent(JSON.stringify(options));
	  });
	 }
	  
	function loadOptions(){
	    var invertSelect = document.getElementById("invert_select");
		var secondsDisplay = document.getElementById("seconds_display");
		var obgcolourDisplay = document.getElementById("obgcolour_display");
		var ibgcolourDisplay = document.getElementById("ibgcolour_display");
		var shcolourDisplay = document.getElementById("shcolour_display");
		var mhcolourDisplay = document.getElementById("mhcolour_display");
		var hhcolourDisplay = document.getElementById("hhcolour_display");
		var tcolourDisplay = document.getElementById("tcolour_display");
		var dcolourDisplay = document.getElementById("dcolour_display");
		var ncolourDisplay = document.getElementById("ncolour_display");
		var dtcolourDisplay = document.getElementById("dtcolour_display");
		var ccolourDisplay = document.getElementById("ccolour_display");
		var bcolourDisplay = document.getElementById("bcolour_display");
		
		if(localStorage["invert"]) {
			invertSelect.checked = localStorage["invert"] === "true";
			secondsDisplay.checked = localStorage["seconds"] === "true";
			obgcolourDisplay.value = localStorage["obgcolour"];
			ibgcolourDisplay.value = localStorage["ibgcolour"];
			shcolourDisplay.value = localStorage["shcolour"];
			mhcolourDisplay.value = localStorage["mhcolour"];
			hhcolourDisplay.value = localStorage["hhcolour"];
			tcolourDisplay.value = localStorage["tcolour"];
			dcolourDisplay.value = localStorage["dcolour"];
			ncolourDisplay.value = localStorage["ncolour"];
			dtcolourDisplay.value = localStorage["dtcolour"];
			ccolourDisplay.value = localStorage["ccolour"];
			bcolourDisplay.value = localStorage["bcolour"];
		}
	}

  </script>
  </html>